function csvjson(){}csvjson.EXP_ROW_SEPARATOR=/\r\n|\r|\n/g,csvjson.ERR_EMPTY_HEADER="ERR_EMPTY_HEADER",csvjson.WARN_EMPTY_ROWS="WARN_EMPTY_ROWS",csvjson.Split=function(line,COL_SEPARATOR){var VAL_SEPARATOR='"';if(null==COL_SEPARATOR||"undefined"==typeof COL_SEPARATOR)throw"CSV Column separator is null.";for(var STATE={INIT:{id:0},READVAL:{id:1}},cells=[],value="",status=STATE.READVAL,counterValSeparators=0,i=0;i<line.length;i++){var c=line[i];switch(c){case VAL_SEPARATOR:counterValSeparators++,value+=c;break;case COL_SEPARATOR:counterValSeparators%2!=0?value+=c:(cells.push(value),counterValSeparators=0,value="");break;default:status=STATE.READVAL,value+=c}}return value.trim().length>0&&cells.push(value),cells},csvjson.RecogniseCSVSeparator=function(rows){var tryToSplit=function(rows,colsep){for(var numCols=-1,i=1;i<rows.length&&10>i;i++){var _row=rows[i].trim(),cells=csvjson.Split(_row,colsep),rowNumCols=cells.length;if(_row.trim().lastIndexOf(colsep)===_row.length-1&&rowNumCols++,-1==numCols&&rowNumCols>1)numCols=rowNumCols;else if(numCols!=rowNumCols)return!1}return!0},SEPARATOR=";",foundSparator=tryToSplit(rows,SEPARATOR);if(foundSparator)return SEPARATOR;if(SEPARATOR=",",foundSparator=tryToSplit(rows,SEPARATOR))return SEPARATOR;throw"Cannot infer the CSV column separator."},csvjson.prototype=function(){var _processHeader=function(header,colseparator){if(null==colseparator||"undefined"==typeof colseparator)throw"Cannot process the CSV header because the column separator is null";var headerNames=header.split(colseparator),fields=[];return headerNames.forEach(function(item,index){var name=item.replace(/\s/,"_"),field={name:name,label:item,index:index};fields.push(field),fields[name]=field}),fields};return{constructor:csvjson,read:function(csvContent,rowSeparator){var records=[],fields=null,startIndex=0,errors={},warnings={};warnings[csvjson.WARN_EMPTY_ROWS]=0,"undefined"==typeof rowSeparator&&(rowSeparator=csvjson.EXP_ROW_SEPARATOR);for(var rows=csvContent.split(rowSeparator),separator=csvjson.RecogniseCSVSeparator(rows);0==rows[startIndex].trim().length;)errors[csvjson.ERR_EMPTY_HEADER]++,startIndex++;fields=_processHeader(rows[startIndex],separator);for(var i=startIndex+1;i<rows.length;i++){for(var row=rows[i],values=csvjson.Split(row,separator),jsonRow={},j=0;j<values.length;j++){var value=values[j];"undefined"==typeof fields[j];var key=fields[j].name;jsonRow[key]=value}records.push(jsonRow)}return{fields:fields,records:records,errors:errors,warnings:warnings}}}}();